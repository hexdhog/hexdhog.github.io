{{- /*  layouts/partials/head.html  -  full working version for Archie + toggle + chroma  */ -}}
{{/*  All the normal head stuff from baseof.html is already output before this partial is called  */}}

{{/*  Main stylesheet  */}}
{{ $style := resources.Get "css/main.css" | fingerprint }}
<link rel="stylesheet" href="{{ $style.RelPermalink }}">

{{/*  Dark mode stylesheet  */}}
{{- if or (eq .Site.Params.mode "auto") (eq .Site.Params.mode "toggle") (eq .Site.Params.mode "dark") }}
  {{ $dark := resources.Get "css/dark.css" | fingerprint }}
  <link id="darkModeStyle" rel="stylesheet" href="{{ $dark.RelPermalink }}"
        {{ if eq .Site.Params.mode "auto" }}media="(prefers-color-scheme: dark)"{{ end }}
        {{ if eq .Site.Params.mode "toggle" }}disabled{{ end }}>
{{- end }}

{{/*  Chroma syntax highlighting - light + dark  */}}
{{- if or (eq .Site.Params.mode "auto") (eq .Site.Params.mode "toggle") (eq .Site.Params.mode "dark") }}
  {{ $light := resources.Get "css/chroma-light.css" | minify | fingerprint }}
  {{ $dark  := resources.Get "css/chroma-dark.css"  | minify | fingerprint }}
  <link rel="stylesheet" href="{{ $light.RelPermalink }}"
        media="(prefers-color-scheme: light), (data-mode: light)"
        id="chroma-light"
        integrity="{{ $light.Data.Integrity }}">
  <link rel="stylesheet" href="{{ $dark.RelPermalink }}"
        media="(prefers-color-scheme: dark), (data-mode: dark)"
        id="chroma-dark"
        disabled
        integrity="{{ $dark.Data.Integrity }}">
{{- end }}

{{/*  Your custom fixes â€“ must load last  */}}
{{ $custom := resources.Get "css/custom.css" | minify | fingerprint }}
<link rel="stylesheet" href="{{ $custom.RelPermalink }}" integrity="{{ $custom.Data.Integrity }}">